##Creating a pluggable database

*opening sqlplus and login as db admin*
'sqlplus sys as SYSDBA'

*finding location of seed database files*
'SELECT name FROM v$datafile where con_id=2;'

**My database files location**
*C:\REGAPP\REGIS\PRODUCT\23AI\ORADATA\FREE\PDBSEED\SYSTEM01.DBF
C:\REGAPP\REGIS\PRODUCT\23AI\ORADATA\FREE\PDBSEED\SYSAUX01.DBF
C:\REGAPP\REGIS\PRODUCT\23AI\ORADATA\FREE\PDBSEED\UNDOTBS01.DBF*

*creating the pluggable database*
'''  CREATE PLUGGABLE DATABASE tue_28757_Regis_medaid_db
  2  ADMIN USER regis_admin IDENTIFIED BY admin
  3  FILE_NAME_CONVERT = ('C:\REGAPP\REGIS\PRODUCT\23Ai\ORADATA\FREE\PDBSEED\',
  4                       'C:\REGAPP\REGIS\PRODUCT\23Ai\ORADATA\FREE\tue_28757_Regis_medaid_db\');'''

#Other usefull codes

*show pdbs present*
'show pdbs'

*Save current container name for verification*
'''COLUMN current_container NEW_VALUE current_container
SELECT SYS_CONTEXT('USERENV', 'CON_NAME') AS current_container FROM DUAL;'''

*Switch to new PDB*
'ALTER SESSION SET CONTAINER = tue_28757_Regis_medaid_db;'

*Verify switch*
'SELECT SYS_CONTEXT('USERENV', 'CON_NAME') AS current_container FROM DUAL;'



#Tablespace configuration
*Data tablespace*
'''CREATE TABLESPACE medaid_data 
DATAFILE 'medaid_data01.dbf' SIZE 100M AUTOEXTEND ON NEXT 50M MAXSIZE 1G;'''

*Index tablespace* 
'''CREATE TABLESPACE medaid_index
 DATAFILE 'medaid_index01.dbf' SIZE 50M AUTOEXTEND ON NEXT 25M MAXSIZE 500M;'''

*Temporary tablespace*
'''CREATE TEMPORARY TABLESPACE medaid_temp
 TEMPFILE 'medaid_temp01.dbf' SIZE 50M AUTOEXTEND ON;'''



#User configuration
*Create application user*
'''CREATE USER medaid_user IDENTIFIED BY firstaid123
DEFAULT TABLESPACE medaid_data
TEMPORARY TABLESPACE medaid_temp
QUOTA UNLIMITED ON medaid_data
QUOTA UNLIMITED ON medaid_index;'''

*Grant privileges*
'''GRANT CONNECT, RESOURCE TO medaid_user;
GRANT CREATE SESSION, CREATE VIEW, CREATE SEQUENCE TO medaid_user;
GRANT UNLIMITED TABLESPACE TO medaid_user;'''



#Verification on tablespaces and user

*Verify tablespaces*
'''SELECT tablespace_name, file_name, bytes/1024/1024 as size_mb 
FROM dba_data_files 
WHERE tablespace_name LIKE 'MEDAID%';'''

*Verify user*
'''SELECT username, default_tablespace, temporary_tablespace, created
FROM dba_users 
WHERE username = 'MEDAID_USER';'''

*Verify privileges*
'''SELECT privilege FROM dba_sys_privs WHERE grantee = 'MEDAID_USER'
UNION
SELECT privilege FROM dba_sys_privs WHERE grantee IN (
    SELECT granted_role FROM dba_role_privs WHERE grantee = 'MEDAID_USER'
);'''



-- Open your PDB
ALTER PLUGGABLE DATABASE tue_28757_Regis_medaid_db OPEN;

-- Set it to open automatically on restart
ALTER PLUGGABLE DATABASE tue_28757_Regis_medaid_db SAVE STATE;

-- Check current memory settings
SHOW PARAMETER sga_target;
SHOW PARAMETER pga_aggregate_target;

-- Set memory parameters (adjust based on your system)
ALTER SYSTEM SET sga_target = 500M SCOPE = BOTH;
ALTER SYSTEM SET pga_aggregate_target = 200M SCOPE = BOTH;
ALTER SYSTEM SET memory_target = 700M SCOPE = BOTH;


-- Check if archive logging is enabled
ARCHIVE LOG LIST;

-- Enable archive logging (if not enabled)
-- First, shutdown the database
SHUTDOWN IMMEDIATE;

-- Start in mount mode
STARTUP MOUNT;

-- Enable archiving
ALTER DATABASE ARCHIVELOG;

-- Open database
ALTER DATABASE OPEN;


-- Check current datafiles
SELECT file_name, tablespace_name, bytes/1024/1024 as MB, 
       autoextensible, maxbytes/1024/1024 as max_MB
FROM dba_data_files
WHERE tablespace_name IN ('MADAID_DATA', 'MADAID_INDEX');

-- Add AUTOEXTEND if not set
ALTER DATABASE DATAFILE 'medaid_data01.dbf' 
AUTOEXTEND ON NEXT 50M MAXSIZE 2G;

ALTER DATABASE DATAFILE 'medaid_index01.dbf' 
AUTOEXTEND ON NEXT 25M MAXSIZE 1G;


